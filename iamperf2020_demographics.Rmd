---
title: "Survey demographics"
output: 
  html_document: 
    df_print: default
    toc: yes
  html_notebook: 
    toc: yes
---

<center> *David Doret* </center>
<center> *Version 1.0* </center>
<center> *June 2020* </center>

## In a nutshell

In this R notebook, ...

## Introduction

As part of the *IAM Performance Measurement 2020 Survey*, I surveyed IAM professionals ...

This notebook focuses on data analysis. Its business implications are discussed in a distinct article.

## Setting up the technical environment

To conduct our data analysis, we first need to setup our R technical environment.

```{r echo=TRUE, message=FALSE}

# Set console to English
Sys.setenv(LANG = "en");

# Install R packages as needed
if(!require("devtools")) install.packages("devtools");
#if(!require("eulerr")) install.packages("eulerr");
#if(!require("tidyr")) install.packages("tidyr");
#if(!require("RCurl")) install.packages("RCurl");
#if(!require("plyr")) install.packages("plyr");
#if(!require("dplyr")) install.packages("dplyr");
#if(!require("knitr")) install.packages("knitr");
#if(!require("stringr")) install.packages("stringr");
#if(!require("remotes")) install.packages("remotes");
#if(!require("stringr.tools")) #remotes::install_github("decisionpatterns/stringr.tools");
#if(!require("sjlabelled")) install.packages("sjlabelled");
#if(!require("naniar")) install.packages("naniar");
#if(!require("tidyverse")) install.packages("tidyverse");
#if(!require("likert")) install.packages("likert");
#if(!require("matrixStats")) install.packages("matrixStats");
#if(!require("sjmisc")) install.packages("sjmisc");
#if(!require("ggplot2")) install.packages("ggplot2");
#if(!require("ggpubr")) install.packages("ggpubr");
#if(!require("VGAM")) install.packages("VGAM");
#if(!require("gridExtra")) install.packages("gridExtra");

```

## Loading the IAMPerf2020 data environment

```{r}
devtools::source_url("https://raw.githubusercontent.com/Open-Measure/Open-Data/master/IAMPerf2020-Dataset/IAMPerf2020Setup.R?raw=TRUE")
```

## Devices

```{r}

summarize_devices = function(survey_data){
  all_surveys_devices = table(survey_data$Device);
  completed_surveys_devices = table(survey_data[survey_data$ResponseStatus == "Completed",]$Device);
  
  plot_data = data.frame(
    fill = c(names(all_surveys_devices), names(completed_surveys_devices)),
    y = c(all_surveys_devices, completed_surveys_devices),
    x = c(rep("All surveys", 3), rep("Completed surveys", 3))
  );
  
  label_percent = c(
    paste(rounded_ratios_with_largest_remainder(all_surveys_devices, 100, 2), "%", sep = ""),
    paste(rounded_ratios_with_largest_remainder(completed_surveys_devices, 100, 2), "%", sep = "")
    );
  label_absolute = paste("(", plot_data$y, ")", sep = "");
  label = paste(label_percent, label_absolute, sep = "\n");
  plot_data$label = label;

  return(plot_data);  
};

# Stacked + percent
ggplot2::ggplot(
  summarize_devices(iamperf2020_survey), 
  ggplot2::aes(fill=fill, y=y, x= x, label = label)
  ) + 
  ggplot2::geom_bar(position="fill", stat="identity") +
  ggplot2::geom_text(size = 3, position = ggplot2::position_fill(vjust = 0.5)) + 
  ggplot2::xlab("Survey sets") +
  ggplot2::scale_x_discrete (limits = c("All surveys", "Completed surveys")) +
  ggplot2::scale_y_continuous (name = "%") +
  ggplot2::scale_fill_brewer(palette = "Paired") +
  ggplot2::labs(title = "Devices", subtitle = "The device category used by survey participants", fill = "Device");

```




# References

I list here a bunch of articles that have been inspiring or helpful while writing this notebook.

 * https://stackoverflow.com/questions/35720660/how-to-use-an-r-script-from-github
 